version: '3.8'

services:
  cloud-saves:
    build: .
    container_name: sillytavern-backup
    
    # 环境变量配置
    # Docker Compose 会自动从 .env 文件加载环境变量
    # 请复制 .env.example 为 .env 并修改配置
    env_file:
      - .env
    
    # 卷挂载
    volumes:
      # SillyTavern 数据目录（只读挂载，保护源数据）
      - /var/sillytavern/data:/data:ro
      
      # SSH 密钥（用于 GitHub 认证，只读）
      - ~/.ssh:/root/.ssh:ro
      
      # 日志持久化
      - ./logs:/app/logs
      
      # 备份仓库持久化卷
      - backup-repo:/backup
      
      # 可选：如果不使用环境变量，挂载配置文件
      # - ./config.json:/app/config.json:ro
    
    # 重启策略
    restart: unless-stopped
    
    # 网络模式（仅出站连接）
    network_mode: bridge

volumes:
  backup-repo:
    driver: local
