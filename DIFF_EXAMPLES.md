# 比较存档差异功能说明

## 功能特性

✅ **双模式比较**：
1. **历史备份 vs 当前数据** - 查看某个历史备份与当前数据的差异
2. **历史备份 vs 另一个历史备份** - 比较两个历史备份之间的差异

✅ **智能分类**：
- 💬 聊天记录
- 👤 角色卡
- ⚙️ 配置文件
- 📄 其他文件

✅ **详细信息**：
- 文件大小变化
- 文件数量统计
- 按变化量排序（聊天记录）

## 使用场景

**场景1**：我想知道今天聊了哪些角色，跟昨天的备份比一下
```
选择模式2 → 选择今天的备份 → 选择昨天的备份
```

**场景2**：想看看当前数据比上次备份多了什么
```
选择模式1 → 选择上次的备份
```

**场景3**：想对比两天前和一周前的备份，看看那段时间聊了啥
```
选择模式2 → 选择两天前的备份 → 选择一周前的备份
```

## 输出示例

### 示例1：历史备份 vs 当前数据

```
================================================================================
差异分析结果：备份 a7f3c21 ⟷ 当前数据
================================================================================

📂 仅在 备份 a7f3c21 中存在 (共 2 个):
   💬 聊天记录 (1 个):
      - chats/爱丽丝_20260215.jsonl
   
   👤 角色卡 (1 个):
      - characters/旧角色.png

📂 仅在 当前数据 中存在 (共 5 个):
   💬 聊天记录 (3 个):
      + chats/Bob_20260217.jsonl
      + chats/夏洛特_20260217.jsonl
      + chats/玛丽_20260216.jsonl
   
   👤 角色卡 (2 个):
      + characters/新角色A.png
      + characters/新角色B.json

🔄 已修改的文件 (共 4 个):
   💬 聊天记录 (3 个):
      ~ chats/爱丽丝.jsonl (45632 → 58921 bytes, +13289)
      ~ chats/Bob.jsonl (12345 → 15678 bytes, +3333)
      ~ chats/夏洛特.jsonl (98765 → 87654 bytes, -11111)
   
   ⚙️ 配置文件:
      ~ settings.json (2048 → 2156, +108)

================================================================================

图例：
  - 仅在第一个版本
  + 仅在第二个版本
  ~ 两个版本都有但内容不同
================================================================================
```

### 示例2：历史备份 vs 历史备份

```
================================================================================
差异分析结果：备份 a7f3c21 ⟷ 备份 b8e4d32
================================================================================

📂 仅在 备份 a7f3c21 中存在 (共 1 个):
   💬 聊天记录 (1 个):
      - chats/临时对话_20260215.jsonl

📂 仅在 备份 b8e4d32 中存在 (共 3 个):
   💬 聊天记录 (2 个):
      + chats/新对话A_20260216.jsonl
      + chats/新对话B_20260216.jsonl
   
   👤 角色卡 (1 个):
      + characters/新角色.png

🔄 已修改的文件 (共 2 个):
   💬 聊天记录 (2 个):
      ~ chats/主要角色.jsonl (100000 → 120000 bytes, +20000)
      ~ chats/辅助角色.jsonl (50000 → 48000 bytes, -2000)

================================================================================

图例：
  - 仅在第一个版本
  + 仅在第二个版本
  ~ 两个版本都有但内容不同
================================================================================
```

### 示例3：完全一致

```
================================================================================
差异分析结果：备份 c9f5e43 ⟷ 当前数据
================================================================================

✅ 两个版本完全一致

================================================================================
```

## 图标说明

- `📂` - 文件分类
- `💬` - 聊天记录
- `👤` - 角色卡
- `⚙️` - 配置文件
- `📄` - 其他文件
- `-` - 仅在第一个版本存在（已删除或旧版本独有）
- `+` - 仅在第二个版本存在（新增）
- `~` - 两个版本都有但内容不同（已修改）

## 文件大小显示

对于修改的文件，会显示：
- 原始大小 → 新大小
- 差异（正数表示增加，负数表示减少）

例如：
```
~ chats/爱丽丝.jsonl (45632 → 58921 bytes, +13289)
                      ↑       ↑              ↑
                   原大小   新大小        增加了13KB
```

## 排序规则

- **聊天记录**：按文件大小变化量排序（变化最大的在前）
- **其他类别**：按文件名字母顺序排序

## 限制说明

为避免输出过长：
- 聊天记录：最多显示 5 个
- 角色卡：最多显示 3 个
- 配置文件：显示全部
- 其他文件：仅当 ≤5 个时显示

超过限制会显示 "... 还有 X 个"
